<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<script type="text/javascript" src="/static/js/head.js"></script>
<link rel="stylesheet" type="text/css" href="/static/css/contractList.css" />
</head> 
<body id="layout" class="easyui-layout">
	<div data-options="region:'center',border:false">
		<table id="infoDrid"></table>
	</div>
<!-- 查询条件 -->
<div data-options="region:'east',split:true,title:'信息查询',border:false" style="width:250px;padding:5px;">
<form id="searchForm">
	<table class="searchTable">
		<tr>
			<td class="searchLeft">合同名称：</td>
			<td class="searchRight">
				<input class="easyui-validatebox" name="username" id="usernameSearch">
			</td>
		</tr>
		<tr>
			<td  class="searchLeft">合同编号：</td>
			<td class="searchRight">
				<input class="easyui-validatebox" name="loginname" id="loginnameSearch" value=''>
				<input id="signdate" type="hidden" value="">
			</td>
		</tr>
		<tr>
			<td class="searchLeft">开始时间：</td>
			<td class="searchRight">
				<input class="easyui-datetimebox" name="stattime" id="stattimeSearch">
			</td>
		</tr>
		<tr>
			<td  class="searchLeft">结束时间：</td>
			<td class="searchRight">
				<input class="easyui-datetimebox" name="endtime" id="endtimeSearch">
			</td>
		</tr>
	</table>
	<div>
	<a id="searchbtn" class="easyui-linkbutton" data-options="iconCls:'icon-ccSearch'" style="margin-left:50px">查询</a>
	<a id="resetbtn"   class="easyui-linkbutton" data-options="iconCls:'icon-ccReload'">重置</a>
	</div>
	</form>
</div>
<!-- dataGrid工具栏 -->
<div id="toolbar">
	<a id="search" href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-ccSearch',plain:true" >查询</a>
	<a id="track" href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-ccSearch',plain:true" >查看订单</a>
	</div>
</body>
</html>

<script>
	$(function(){
		//页面初始化
		layoutLoad();
		//数据表格加载
		gridLoad(1,20);	
		//loadAndSetGridData();	
		//点击事件
		clickFunction();
		
	});
	//页面初始化
	function layoutLoad(){
		$('#layout').layout('collapse','east');
	}
	var t = 0;
	//数据表格加载
	function gridLoad(pageNumber,pageSize) {
		$.ajax({
			url : getHost() + '/contract/list/pageable/adapter/order_by_create_time_desc',
			type : "GET",
			data : {
				"pageNumber": pageNumber,
			    "pageSize": pageSize,
			},
			async : false,
			dataType : "json",
			contentType: 'application/json;charset=UTF-8',
			success : function(data) {
				if (data.code==200&&typeof(data.data) == "object") {
					var width = $('#infoDrid').parent().width();
					var height = $('#infoDrid').parent().height();
					$('#infoDrid').datagrid({
						toolbar : "#toolbar",
						data: data.data.page.rows,
						width : width,
						height : height,
						async : false,
						fit : true,
						border : false,
						singleSelect : true,
						fitColumns : true,
						striped : true,
						pagination : true,
						columns : [ [
							{field:'regionList',title:'区域',align:'center',width:150},
							{field:'firstPartyName',title:'甲方名称',align:'center',width:150},
							{field:'secondPartyName',title:'乙方名称',align:'center',width:150},
							{field:'contractName',title:'合同名称',align:'center',width:150},
							{field:'contractNo',title:'合同编号',align:'center',width:100},
							{field:'contractAmount',title:'合同金额(元)',align:'center',width:150},
							{field:'signTime',title:'签订时间',align:'center',width:150},
							{field:'startTime',title:'开始时间',align:'center',width:150},
							{field:'createUser',title:'创建人',align:'center',width:100,
								formatter: function(value,row,index){
									return value.nickname;
								}
							},
							{field:'createTime',title:'创建时间',align:'center',width:200},
						] ],
					});
						var p = $('#infoDrid').datagrid('getPager');
				        $(p).pagination({
				        	total : data.data.page.total,
				            pageSize: pageSize,//每页显示的记录条数，默认为10
				            pageList: [20, 40, 100],//可以设置每页记录条数的列表
				            pageNumber:pageNumber,
				            beforePageText: '第',//页数文本框前显示的汉字
				            afterPageText: '页    共 {pages} 页',
				            displayMsg: '当前显示 {from}-{to} 条记录,共 {total} 条记录',
				            showRefresh : false,
				            onSelectPage:function(pageNumber, pageSize){
				        		console.log('pageNumber:'+pageNumber+',pageSize:'+pageSize);
				        		gridLoad(pageNumber,pageSize);
				        	}
				        });
				} else {
					
				}
			}
		});
		t+=1;
	}
	//点击事件
	function clickFunction() {
		$('#search').click(function() {
			$('#layout').layout('expand', 'east');
		});
		$('#export').click(function() {
			window.location.href = "";
		});
		//点击查询
		$('#searchbtn').click(function() {
			gridLoad();
		});
		$('#resetbtn').click(function() {
			$('#searchForm')[0].reset();
			$("#loginnameSearch").val('');
			$("#signdate").val('');
			$('#stattimeSearch').datetimebox('setValue', '');
			$('#endtimeSearch').datetimebox('setValue', '');
			gridLoad();
		});
		//查看足迹
		$('#track').click(function() {
			var date = $('#signdate').val() == "" ? new Date()
					: new Date($('#signdate').val());
			parent.addTab('订单详情', "url")
		});
	}
</script>